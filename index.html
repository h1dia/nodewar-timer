<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æ‹ ç‚¹æˆ¦ã‚¿ã‚¤ãƒãƒ¼</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --accent: #38bdf8;
            --text: #f8fafc;
            --danger: #ef4444;
            --success: #10b981;
            --delay-color: #fbbf24;
            --info-bg: #334155;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Consolas', 'Monaco', 'Meiryo', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 40px 20px;
        }

        h1 { color: var(--accent); margin-bottom: 30px; letter-spacing: 2px; }

        .wrapper {
            display: flex;
            gap: 30px;
            max-width: 950px;
            width: 100%;
            margin-bottom: 20px;
            transition: flex-direction 0.3s ease;
        }
        .wrapper.reverse { flex-direction: row-reverse; }

        .settings-panel {
            background: var(--card);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            flex: 0 0 400px;
            text-align: center;
        }

        #live-clock { font-size: 4rem; font-weight: 800; color: var(--accent); margin-bottom: 1rem; }

        .delay-section {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid var(--delay-color);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            display: flex; justify-content: center; align-items: center; gap: 10px;
        }

        .input-number {
            background: #334155; border: 1px solid #475569; color: white;
            padding: 5px; border-radius: 4px; text-align: center;
        }

        .alarm-row { display: flex; gap: 10px; margin-bottom: 12px; align-items: center; justify-content: center; }

        .countdown-panel { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .countdown-card {
            background: var(--card); padding: 15px 25px; border-radius: 12px;
            display: flex; justify-content: space-between; align-items: center;
            border-left: 4px solid var(--accent);
        }
        .countdown-card.finished { border-left-color: #475569; opacity: 0.5; }
        .card-timer { font-size: 1.6rem; color: var(--delay-color); }

        .action-bar {
            max-width: 950px; width: 100%;
            display: flex; gap: 10px; margin-bottom: 20px;
        }

        .btn { cursor: pointer; border: none; border-radius: 5px; padding: 10px 15px; font-weight: bold; transition: 0.2s; }
        .btn-utility { background: #64748b; color: white; flex: 1; }
        .btn-add { background: var(--success); color: white; width: 100%; margin-top: 10px; }
        .btn-del { background: var(--danger); color: white; }

        .info-card {
            max-width: 950px; width: 100%; background: var(--info-bg);
            padding: 1.5rem 2rem; border-radius: 15px; line-height: 1.6;
        }
        .info-card h2 { margin-top: 0; font-size: 1.2rem; color: var(--accent); }
    </style>
</head>
<body>
    <div class="wrapper" id="main-wrapper">
        <div class="settings-panel">
            <div id="live-clock">00:00:00</div>
            <div class="delay-section">
                <label>é…å»¶:</label>
                <input type="number" id="global-delay" class="input-number" value="0" min="0" style="width: 60px;">
                <span>ç§’</span>
            </div>
            <div id="alarm-list-inputs"></div>
            <button class="btn btn-add" onclick="addAlarmRow()">+ ã‚¢ãƒ©ãƒ¼ãƒ ã‚’è¿½åŠ </button>
        </div>

        <div class="countdown-panel" id="countdown-container"></div>
    </div>

    <div class="action-bar">
        <button class="btn btn-utility" onclick="toggleLayout()">â‡„ å·¦å³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ‡æ›¿</button>
        <button class="btn btn-utility" onclick="toggleInputMode()">ğŸ•’ ã‚¿ã‚¤ãƒãƒ¼åˆ‡æ›¿</button>
    </div>

    <div class="info-card">
        <h2>ã¤ã‹ã„ã‹ãŸ</h2>
        <ul>
            <li><strong>é…å»¶:</strong> ã‚¢ãƒ©ãƒ¼ãƒ ã®çµ‚äº†æ™‚åˆ»ã‚’æŒ‡å®šç§’æ•°ãšã‚‰ã—ã¾ã™ã€‚</li>
            <li><strong>å·¦å³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ‡æ›¿:</strong> è¨­å®šã¨ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã®é…ç½®ã‚’å…¥ã‚Œæ›¿ãˆã¾ã™ã€‚</li>
            <li><strong>æ™‚åˆ»ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿:</strong> ã€Œæ™‚åˆ»ã€å½¢å¼ã¨ã€Œåˆ†ã€å½¢å¼ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚ï¼ˆé–‹å§‹ç›´å¾Œã«è¡¨ç¤ºã•ã‚ŒãŸç ¦ã®æ™‚é–“ã‚’å…¥åŠ›ã™ã‚‹ã¨ã„ã„æ„Ÿã˜ã«ãªã‚Šã¾ã™ï¼‰</li>
        </ul>
    </div>

<script>
    const triggered = new Set();
    let alarmCount = 0;
    let inputMode = 'minute'; // åˆæœŸã¯åˆ†ã®ã¿ãƒ¢ãƒ¼ãƒ‰

    function addAlarmRow(h = 21, m = 20) {
        const id = `alarm-${Date.now()}-${alarmCount++}`;
        const inputList = document.getElementById('alarm-list-inputs');
        const row = document.createElement('div');
        row.className = 'alarm-row';
        row.id = `row-${id}`;
        
        renderRow(row, id, h, m);
        inputList.appendChild(row);

        const container = document.getElementById('countdown-container');
        const card = document.createElement('div');
        card.className = 'countdown-card';
        card.id = `card-${id}`;
        card.innerHTML = `<div class="card-info"><span class="display-time">--:--</span><span class="delay-val"></span></div><div class="card-timer">00:00:00</div>`;
        container.appendChild(card);
    }

    function renderRow(row, id, h, m) {
        if (inputMode === 'time') {
            row.innerHTML = `
                <input type="number" class="input-number h" value="${h}" min="0" max="23" style="width: 45px;">æ™‚
                <input type="number" class="input-number m" value="${m}" min="0" max="59" style="width: 45px;">åˆ†
                <button class="btn btn-del" onclick="removeAlarm('${id}')">å‰Šé™¤</button>`;
        } else {
            row.innerHTML = `
                <input type="number" class="input-number m-only" value="${m}" min="0" max="59" style="width: 55px;">åˆ†å¾Œã«çµ‚äº†ã™ã‚‹ç ¦ã§ã™ã€‚
                <button class="btn btn-del" onclick="removeAlarm('${id}')">å‰Šé™¤</button>`;
        }
    }

    function removeAlarm(id) {
        const r = document.getElementById(`row-${id}`);
        const c = document.getElementById(`card-${id}`);
        if(r) r.remove();
        if(c) c.remove();
    }

    function toggleLayout() {
        document.getElementById('main-wrapper').classList.toggle('reverse');
    }

    function toggleInputMode() {
        const rows = document.querySelectorAll('.alarm-row');
        const prevMode = inputMode;
        inputMode = (inputMode === 'time') ? 'minute' : 'time';

        rows.forEach(row => {
            const id = row.id.replace('row-', '');
            let h = parseInt(row.querySelector('.h')?.value) || 21;
            let m = parseInt(row.querySelector('.m')?.value || row.querySelector('.m-only')?.value) || 0;

            if (prevMode === 'time' && inputMode === 'minute') {
                // æ™‚åˆ»ãƒ¢ãƒ¼ãƒ‰(21:21) â†’ åˆ†ã®ã¿ãƒ¢ãƒ¼ãƒ‰(20) : ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰1å¼•ã
                m--;
                if (m < 0) { m = 59; h = (h - 1 < 0) ? 23 : h - 1; }
            } else if (prevMode === 'minute' && inputMode === 'time') {
                // åˆ†ã®ã¿ãƒ¢ãƒ¼ãƒ‰(20) â†’ æ™‚åˆ»ãƒ¢ãƒ¼ãƒ‰(21:21) : ãƒ†ã‚­ã‚¹ãƒˆã«1è¶³ã™
                m++;
                if (m >= 60) { m = 0; h = (h + 1) % 24; }
            }

            renderRow(row, id, h, m);
        });
    }

    // åˆæœŸãƒ‡ãƒ¼ã‚¿ (åˆ†ã®ã¿ãƒ¢ãƒ¼ãƒ‰ãªã®ã§ã€Œ20ã€ã¨å…¥ã‚Œã‚‹ã¨å†…éƒ¨ã§21åˆ†ã¨ã—ã¦æ‰±ã†)
    addAlarmRow(21, 20);
    addAlarmRow(21, 40);

    function update() {
        const now = new Date();
        const delaySec = parseInt(document.getElementById('global-delay').value) || 0;
        document.getElementById('live-clock').innerText = now.toTimeString().split(' ')[0];

        document.querySelectorAll('.alarm-row').forEach(row => {
            const id = row.id.replace('row-', '');
            const card = document.getElementById(`card-${id}`);
            if(!card) return;

            let h, m;
            if (inputMode === 'time') {
                // æ™‚åˆ»ãƒ¢ãƒ¼ãƒ‰ï¼šè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹æ•°å€¤ã®ã¾ã¾è¨ˆç®—
                h = parseInt(row.querySelector('.h').value) || 0;
                m = parseInt(row.querySelector('.m').value) || 0;
            } else {
                // åˆ†ã®ã¿ãƒ¢ãƒ¼ãƒ‰ï¼šè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹æ•°å€¤(20)ã« +1åˆ†(21) ã—ã¦è¨ˆç®—
                h = 21;
                m = (parseInt(row.querySelector('.m-only').value) || 0) + 1;
                if (m >= 60) { m = 0; h = 22; }
            }

            const targetDate = new Date();
            targetDate.setHours(h, m, 0, 0);
            targetDate.setSeconds(targetDate.getSeconds() + delaySec);

            const diffMs = targetDate - now;
            card.querySelector('.display-time').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
            card.querySelector('.delay-val').innerText = `(+${delaySec}s)`;

            const timerEl = card.querySelector('.card-timer');
            if (diffMs > 0) {
                card.classList.remove('finished');
                const sTotal = Math.floor(diffMs / 1000);
                const hh = Math.floor(sTotal / 3600);
                const mm = Math.floor((sTotal % 3600) / 60);
                const ss = sTotal % 60;
                timerEl.innerText = `${hh.toString().padStart(2,'0')}:${mm.toString().padStart(2,'0')}:${ss.toString().padStart(2,'0')}`;
            } else {
                card.classList.add('finished');
                timerEl.innerText = "00:00:00";
            }

            if (Math.floor(diffMs / 1000) === 0) {
                const key = `${id}-${targetDate.getTime()}`;
                if (!triggered.has(key)) {
                    triggered.add(key);
                }
            }
        });
    }

    setInterval(update, 1000);
    update();
</script>

</body>
</html>

